# Prometheus values for Todo Chatbot monitoring
# US8: Minimal resource configuration for Always Free tier

prometheus:
  prometheusSpec:
    # Resource limits for free tier
    resources:
      requests:
        cpu: 100m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi

    # Short retention for free tier storage
    retention: 3d
    retentionSize: 5GB

    # Scrape configs for services
    additionalScrapeConfigs:
      - job_name: 'todo-chatbot-services'
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - todo-chatbot
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
            action: replace
            target_label: __metrics_path__
            regex: (.+)
          - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
            action: replace
            target_label: __address__
            regex: ([^:]+)(?::\d+)?;(\d+)
            replacement: $1:$2

      - job_name: 'dapr-sidecars'
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - todo-chatbot
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_container_name]
            action: keep
            regex: daprd
          - source_labels: [__meta_kubernetes_pod_container_port_number]
            action: keep
            regex: "9090"

alertmanager:
  enabled: false  # Disable for free tier

grafana:
  enabled: true
  adminPassword: admin  # Change in production!
  resources:
    requests:
      cpu: 50m
      memory: 256Mi
    limits:
      cpu: 200m
      memory: 512Mi

  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
        - name: 'todo-chatbot'
          orgId: 1
          folder: 'Todo Chatbot'
          type: file
          disableDeletion: false
          editable: true
          options:
            path: /var/lib/grafana/dashboards/todo-chatbot

  dashboardsConfigMaps:
    todo-chatbot: "grafana-dashboards-todo-chatbot"

nodeExporter:
  enabled: false  # Disable for free tier

kubeStateMetrics:
  enabled: true
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi
